{"version":3,"file":"ScrollObserver.js","sources":["ScrollObserver.js"],"sourcesContent":["const convertNumberToFloatingPoint = (step) => {\n  const isInt = `${step}`.indexOf('.') === -1;\n\n  if (step > 100 || (!isInt && Number(step) > 1)) {\n    throw Error(`Not more than 100% allowed: ${JSON.stringify({ step })}`);\n  }\n\n  return isInt ? step / 100 : step;\n};\n\n/**\n * Creates threshold steps for the observer.\n * @param {string} oneStep\n * @param {string} excludeZero\n * @returns {number[]}\n * @memberof ScrollObserver\n */\nconst createSteps = (step) => {\n  let oneStep = step ?? 0.25;\n\n  oneStep = convertNumberToFloatingPoint(oneStep);\n  const steps = Math.round(1 / oneStep);\n\n  const thresholds = Array(steps + 1)\n    .fill()\n    .map((_, i) => {\n      // do not go above 1\n      const num = Number((i * oneStep).toFixed(2));\n      return num > 1 ? 1 : num;\n    });\n\n  return thresholds;\n};\n\nconst hasProp = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);\n\nexport default class ScrollObserver {\n  #options = {};\n  #observer = {};\n  #triggerFunctions = {};\n\n  // ignore setting it on page load\n  #lastScrollPercentage = 'init';\n\n  #isScrollingDown = false;\n  #isScrollingUp = false;\n\n  constructor(options) {\n    this.#init(options);\n\n    // setting document.body as root doesn't work somehow\n    const observerOptions = {\n      threshold: this.#options.thresholds,\n      root:\n        this.#options.target === document.body ? null : this.#options.target,\n      rootMargin: this.#options.rootMargin,\n    };\n\n    this.#observer = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting && entry.intersectionRatio === 1) {\n          // from the element in the DOM\n          const scrollDepth = parseFloat(entry.target.dataset.threshold);\n          const threshold = scrollDepth * 100;\n          const canInteract = scrollDepth >= this.#options.interactWhen;\n          // const currentScrollPercentage = this.#getCurrentScrollPercentage();\n\n          this.#setScrollDirection();\n\n          if (canInteract) {\n            for (const [percent, fns] of Object.entries(\n              this.#triggerFunctions,\n            )) {\n              // only trigger when we are scrolling, otherwise it's pageload\n              if (\n                Number(percent) === scrollDepth\n                && (this.#isScrollingDown || this.#isScrollingUp)\n              ) {\n                fns.forEach((fn) => fn({\n                  depth: threshold,\n                  // current: currentScrollPercentage.rounded,\n                  state: this.#isScrollingDown\n                    ? 'scrolling down'\n                    : 'scrolling up',\n                }));\n              }\n            }\n          }\n\n          // Stop observing.\n          if (this.#options.triggerOnce) {\n            this.#observer.unobserve(entry.target);\n          }\n        }\n      });\n    }, observerOptions);\n\n    this.#setObserverMarkers();\n  }\n\n  #init = (options) => {\n    this.#setupOptions(options);\n\n    this.#setRelativeStyle();\n\n    if (this.#options.showRootMargin) {\n      this.#showRootMargin();\n    }\n  };\n\n  // Set target position to relative to position makers absolute, if main body just set style, otherwise use wrapper\n  #setRelativeStyle = () => {\n    if (this.#options.target === document.body) {\n      this.#options.target.style.position = 'relative';\n    } else {\n      const wrapper = document.createElement('div');\n      wrapper.id = this.#options.scrollWrapperId;\n      wrapper.style.position = 'relative';\n      wrapper.innerHTML = this.#options.target.innerHTML;\n      this.#options.target.innerHTML = '';\n      this.#options.target.appendChild(wrapper);\n    }\n  };\n\n  #showRootMargin = () => {\n    const margins = this.#options.rootMargin.split(' ');\n\n    // eslint-disable-next-line prefer-const\n    let [, topMarginSign, topMargin, topMarginUnit] = /(-?)(\\d+)(\\w+|%)/.exec(\n      margins[0],\n    );\n    topMarginSign = topMarginSign === '' ? '+' : '-';\n\n    // eslint-disable-next-line prefer-const\n    let [, bottomMarginSign, bottomMargin, bottomMarginUnit] = /(-?)(\\d+)(\\w+|%)/.exec(margins[2]);\n    bottomMarginSign = bottomMarginSign === '' ? '+' : '-';\n\n    if (Number(topMargin) === 0 && Number(bottomMargin) === 0) {\n      return;\n    }\n\n    [document.createElement('div'), document.createElement('div')].forEach(\n      (marginElement, i) => {\n        const me = marginElement;\n        const isTopElement = i === 0;\n\n        me.style.position = 'fixed';\n\n        if (isTopElement) {\n          me.style.bottom = `calc(100% ${topMarginSign} ${topMargin}${topMarginUnit})`;\n          me.style.top = 0;\n        } else {\n          me.style.top = `calc(100% ${bottomMarginSign} ${bottomMargin}${bottomMarginUnit})`;\n          me.style.bottom = 0;\n        }\n\n        me.style.boxShadow = isTopElement\n          ? '0 3px 0 rgb(244, 246, 0)'\n          : '0 -3px 0 rgb(244, 246, 0)';\n\n        me.ariaHidden = true;\n\n        me.style.width = '100%';\n        me.style.height = isTopElement\n          ? topMargin + topMarginUnit\n          : bottomMargin + bottomMarginUnit;\n        me.style.background = 'rgba(225,190,18,0.7)';\n        me.style.display = 'block';\n        me.style.pointerEvents = 'none';\n\n        this.#appendElementToTarget(me);\n      },\n    );\n  };\n\n  #setScrollDirection = () => {\n    const currentScrollPercentage = this.#getCurrentScrollPercentage().rounded;\n    if (typeof this.#lastScrollPercentage === 'number') {\n      if (currentScrollPercentage < this.#lastScrollPercentage) {\n        this.#isScrollingDown = false;\n        this.#isScrollingUp = true;\n      } else {\n        this.#isScrollingDown = true;\n        this.#isScrollingUp = false;\n      }\n    }\n    this.#lastScrollPercentage = currentScrollPercentage;\n  };\n\n  /**\n   * Calculates the current scroll position on the page.\n   *\n   * @return {Object} The floating point number as percentage of the scroll position.\n   * @example\n   * { value: 3.285450149338643, rounded: 3, text: '3 %' }\n   */\n  #getCurrentScrollPercentage = () => {\n    const st = 'scrollTop';\n    const sh = 'scrollHeight';\n\n    let depth;\n    let scrollTop;\n\n    let h = document.documentElement;\n    const b = document.body;\n\n    if (this.#options.target === document.body) {\n      depth = (h[sh] || b[sh]) - h.clientHeight;\n      scrollTop = h[st] || b[st];\n    } else {\n      h = document.querySelector(`#${this.#options.scrollWrapperId}`);\n\n      depth = h[sh] - h.clientHeight;\n      scrollTop = h[st];\n    }\n\n    const scrollValue = (scrollTop / depth) * 100;\n    const scrollValueRounded = Math.round(scrollValue);\n\n    return depth === 0\n      ? { value: 0, rounded: 0, text: '0 %' }\n      : {\n        value: scrollValue,\n        rounded: scrollValueRounded,\n        text: `${scrollValueRounded} %`,\n      };\n  };\n\n  // registers a callback function which should trigger at a percentage\n  // exposed the the user\n  observe = (thresholds, fn) => {\n    // transform to array if necessary\n    const thresholdsArr = !Array.isArray(thresholds)\n      ? Array.of(thresholds)\n      : thresholds;\n\n    const currentScrollPercentage = this.#getCurrentScrollPercentage();\n\n    for (const threshold of thresholdsArr) {\n      const step = convertNumberToFloatingPoint(threshold);\n\n      // trigger callbacks already when scroll depth is above threshold on pageload\n      if (\n        this.#options.triggerPrevious\n        && Number(step) * 100 <= currentScrollPercentage.rounded\n      ) {\n        fn({\n          depth: Number(step) * 100,\n          // current: currentScrollPercentage.rounded,\n          state: 'page loaded',\n        });\n\n        // eslint-disable-next-line no-continue\n        if (this.#options.triggerOnce) continue;\n      }\n\n      if (this.#triggerFunctions[step]) {\n        this.#triggerFunctions[step].push(fn);\n        return;\n      }\n      this.#triggerFunctions[step] = [];\n      this.#triggerFunctions[step].push(fn);\n    }\n  };\n\n  #appendElementToTarget = (elem) => {\n    if (this.#options.target === document.body) {\n      this.#options.target.appendChild(elem);\n    } else {\n      document\n        .querySelector(`#${this.#options.scrollWrapperId}`)\n        .appendChild(elem);\n    }\n  };\n\n  // inject markers in the DOM to trigger the observer\n  #setObserverMarkers = () => {\n    this.#options.thresholds.forEach((threshold, i) => {\n      // Create marker and set style.\n      const depthDiv = document.createElement('div');\n      depthDiv.className = this.#options.markerClasses;\n      depthDiv.style.position = 'absolute';\n      depthDiv.style.top = `${100 * threshold}%`;\n      depthDiv.style.pointerEvents = 'none';\n      depthDiv.style.left = '50%';\n      depthDiv.style.transform = 'translateX(-50%)';\n\n      depthDiv.dataset.threshold = threshold;\n      depthDiv.ariaHidden = true;\n      if (this.#options.markerIdPrefix) {\n        depthDiv.id = this.#options.markerIdPrefix + (i + 1);\n      }\n      if (!this.#options.showMarkers) {\n        depthDiv.style.zIndex = '-1';\n      }\n\n      if (this.#options.showMarkers) {\n        depthDiv.style.width = '100%';\n        depthDiv.style.height = '3px';\n        depthDiv.style.background = 'black';\n        depthDiv.style.display = 'block';\n      }\n\n      this.#appendElementToTarget(depthDiv);\n\n      // Observe Marker.\n      this.#observer.observe(depthDiv);\n    });\n  };\n\n  // error checking for thresholds\n  #checkThresholds = () => {\n    const isThresholdsTypeString = typeof this.#options.thresholds === 'string';\n    const isThresholdsTypeArray = Array.isArray(this.#options.thresholds);\n\n    if (!hasProp(this.#options, 'thresholds')) {\n      throw TypeError(\n        `Property 'tresholds' in ${this.constructor.name} options required.`,\n      );\n    } else if (!(isThresholdsTypeString || isThresholdsTypeArray)) {\n      throw TypeError(\n        `Property 'tresholds' in ${this.constructor.name} must be type of 'string' or 'array'.`,\n      );\n    } else if (\n      isThresholdsTypeString\n      && this.#options.thresholds.indexOf('.') === -1\n    ) {\n      throw TypeError(\n        `Property 'tresholds' in ${this.constructor.name} of type string must be floating point value.`,\n      );\n    } else if (isThresholdsTypeString) {\n      this.#options.thresholds = createSteps(this.#options.thresholds);\n    } else if (isThresholdsTypeArray) {\n      // filter duplicates, sort array and convert to floating point values of necessary\n      this.#options.thresholds = [...new Set(this.#options.thresholds)]\n        .sort((a, b) => {\n          if (a === Infinity || Number.isNaN(a)) {\n            throw new TypeError(\n              `Property 'tresholds' in ${this.constructor.name} is invalid. Only numbers are allowed.`,\n            );\n          }\n\n          return a - b;\n        })\n        .map((threshold) => convertNumberToFloatingPoint(threshold));\n    }\n  };\n\n  #formatRootMargin = () => {\n    const margins = this.#options.rootMargin.split(' ');\n\n    // Top Right Bottom Left\n    switch (margins.length) {\n      case 1: // TRBL\n        this.#options.rootMargin = `${margins[0]} `.repeat(4).trimEnd();\n        break;\n      case 2: // TB LR\n        this.#options.rootMargin = `${margins[0]} ${margins[1]} `\n          .repeat(2)\n          .trimEnd();\n        break;\n      case 3: // T LR B\n        this.#options.rootMargin = `${margins[0]} ${margins[1]} ${margins[1]} ${margins[2]}`;\n        break;\n      default:\n        break;\n    }\n  };\n\n  #setupOptions = (options) => {\n    const defaults = {\n      // element to monitor when scrolling\n      target: document.body,\n      /** sets the area margin when to trigger the thresholds,\n       * positive values shifts the detection area outside the screen\n       * to trigger callbacks earlier before they enter the viewport\n       */\n      rootMargin: '0px 0px 0px 0px',\n      /**\n       * These are the measure points, they will trigger the callbacks when the threshold entered the viewport.\n       * They represent percentages.\n       * Can be an array of values:\n       * [0, 10, 25, 45, 50, 70, 100]\n       * [0, 0.10, 0.25, 0.45, 0.50, 0.70, 1]\n       * Can be automatically generated by providing a step as string:\n       * '0.25' => [0, 0.25, 0.50, 0.75, 1]\n       * */\n      thresholds: [0, 0.25, 0.5, 0.75, 1],\n      // triggers only callbacks from this threshold and above, ignores the callbacks below this mark\n      interactWhen: 0,\n      // does not trigger on 0 scroll depth\n      excludeZero: false,\n      // triggers registered callbacks only once when the threshold was passed\n      triggerOnce: false,\n      // triggers registered callbacks on pageload when they are already below the current scroll depth\n      triggerPrevious: false,\n\n      // shows rootMargin areas when thresholds should trigger, may be not visible when it's outside the viewport\n      showRootMargin: false,\n      // display horizontal lines where the markers are located\n      showMarkers: false,\n      // set classes on markers\n      markerClasses: 'sc-scroll-depth-marker',\n      // set IDs for markers as a prefix followed by a number\n      markerIdPrefix: '',\n      scrollWrapperId: 'sc-scroll-wrapper',\n    };\n\n    this.#options = options ?? {};\n\n    // check for unwanted passed options\n    for (const prop of Object.keys(this.#options)) {\n      if (typeof defaults[prop] === 'undefined') {\n        throw new Error(\n          `Property '${prop}' in ${this.constructor.name} options invalid.`,\n        );\n      }\n    }\n\n    this.#checkThresholds();\n\n    // add defaults to options, if not available in passed config\n    for (const [option, val] of Object.entries(defaults)) {\n      if (!hasProp(this.#options, option)) {\n        this.#options[option] = val;\n      }\n    }\n\n    // cut off 0 from the array\n    if (\n      this.#options.excludeZero\n      && this.#options.thresholds.length > 0\n      && this.#options.thresholds[0] === 0\n    ) {\n      this.#options.thresholds = this.#options.thresholds.slice(1);\n    }\n\n    this.#formatRootMargin();\n  };\n}\n"],"names":["convertNumberToFloatingPoint","isInt","step","indexOf","Number","Error","JSON","stringify","createSteps","let","oneStep","steps","Math","round","Array","fill","map","_","i","num","toFixed","hasProp","obj","prop","Object","prototype","hasOwnProperty","call","ScrollObserver","#options","#observer","#triggerFunctions","#lastScrollPercentage","#isScrollingDown","#isScrollingUp","constructor","options","this","#init","observerOptions","threshold","thresholds","root","target","document","body","rootMargin","IntersectionObserver","entries","forEach","entry","isIntersecting","intersectionRatio","scrollDepth","parseFloat","dataset","canInteract","interactWhen","#setScrollDirection","percent","fns","fn","depth","state","triggerOnce","unobserve","#setObserverMarkers","#setupOptions","#setRelativeStyle","showRootMargin","#showRootMargin","wrapper","style","position","createElement","id","scrollWrapperId","innerHTML","appendChild","margins","split","topMarginSign","topMargin","topMarginUnit","exec","bottomMarginSign","bottomMargin","bottomMarginUnit","marginElement","isTopElement","me","bottom","top","boxShadow","ariaHidden","width","height","background","display","pointerEvents","#appendElementToTarget","currentScrollPercentage","#getCurrentScrollPercentage","rounded","st","sh","scrollTop","h","documentElement","b","scrollValue","clientHeight","querySelector","scrollValueRounded","value","text","observe","thresholdsArr","isArray","of","triggerPrevious","push","elem","depthDiv","className","markerClasses","left","transform","markerIdPrefix","showMarkers","zIndex","#checkThresholds","isThresholdsTypeString","isThresholdsTypeArray","TypeError","name","Set","sort","a","Infinity","isNaN","#formatRootMargin","length","repeat","trimEnd","option","val","defaults","excludeZero","keys","slice"],"mappings":"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"}